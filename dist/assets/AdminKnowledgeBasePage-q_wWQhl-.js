import{r as n,ah as W,ai as Y,aj as Z,ak as ee,al as te,am as se,a2 as p,j as e,$ as ae,a0 as U,an as T,ao as ne,ap as B,aq as le,ar as re,as as ie,at as oe,au as de,av as ce,aw as ue,ax as H,a5 as xe,a8 as F,ay as K,a7 as me,a3 as i}from"./index-CRlssNos.js";const he=()=>{const[u,z]=n.useState([]),[I,E]=n.useState(!0),[S,_]=n.useState(!1),[D,A]=n.useState(null),[O,x]=n.useState(!1),[d,m]=n.useState(null),[g,h]=n.useState("manual"),[l,o]=n.useState({name:"",content:"",description:""}),[f,j]=n.useState(null),[P,y]=n.useState(!1),[v,w]=n.useState(null),[N,L]=n.useState(!1),k=n.useRef(null),s=W({extensions:[Y,Z,ee.configure({types:["heading","paragraph"]}),te.configure({openOnClick:!1}),se.configure({placeholder:"Enter content here..."})],content:"",onUpdate:({editor:t})=>{o(a=>({...a,content:t.getHTML()}))}});n.useEffect(()=>{c()},[]),n.useEffect(()=>{s&&!s.isDestroyed&&l.content&&s.commands.setContent(l.content)},[s,l.content]);const c=async()=>{try{E(!0);const t=await p.get("/knowledge-base");t.data.success?z(t.data.data):A("Failed to load knowledge base entries")}catch(t){A("Failed to load knowledge base entries. Please try again later."),console.error("Error fetching knowledge base entries:",t)}finally{E(!1)}},b=()=>{o({name:"",content:"",description:""}),j(null),m(null),x(!1),h("manual"),s&&s.commands.setContent(""),k.current&&(k.current.value="")},$=()=>{h("manual"),x(!0),m(null),o({name:"",content:"",description:""}),s&&s.commands.setContent("")},R=()=>{h("upload"),x(!0),m(null),o({name:"",content:"",description:""}),j(null)},q=t=>{if(t.file_type==="upload"){i.error("Cannot edit uploaded files. Delete and re-upload instead.");return}m(t),h("manual"),x(!0),o({name:t.name,content:t.content||"",description:t.description||""}),s&&s.commands.setContent(t.content||"")},X=t=>{w(t),y(!0)},G=async()=>{if(v)try{L(!0);const t=await p.delete(`/knowledge-base/${v.id}`);t.data.success?(i.success("Entry deleted successfully"),c()):i.error(t.data.detail||"Failed to delete entry")}catch(t){console.error("Error deleting entry:",t),i.error(t.response?.data?.detail||"An error occurred while deleting the entry")}finally{L(!1),y(!1),w(null)}},J=()=>{y(!1),w(null)},Q=t=>{const a=t.target.files?.[0];a&&(j(a),o(r=>({...r,name:a.name})))},V=async()=>{if(g==="manual"){if(!l.name.trim()){i.error("Name is required");return}if(!l.content.trim()){i.error("Content is required");return}}else if(!f){i.error("Please select a file");return}try{if(_(!0),g==="manual"){const t=d?`/knowledge-base/${d.id}`:"/knowledge-base",r=await p[d?"put":"post"](t,{name:l.name,content:l.content,description:l.description});if(r.data.success){let C=d?"Entry updated successfully":"Entry created successfully";r.data.knowledge_base==="updated"?C+=" (Knowledge base updated)":r.data.knowledge_base==="not_updated"&&(C+=" (Knowledge base not updated)",r.data.knowledge_base_error&&console.warn("Knowledge base update failed:",r.data.knowledge_base_error)),i.success(C),b(),c()}else i.error(r.data.detail||"Failed to save entry")}else{const t=new FormData;t.append("file",f),l.description&&t.append("description",l.description);const a=await p.post("/knowledge-base/upload",t,{headers:{"Content-Type":"multipart/form-data"}});if(a.data.success){let r="File uploaded successfully";a.data.knowledge_base==="updated"?r+=" (Knowledge base updated)":a.data.knowledge_base==="not_updated"&&(r+=" (Knowledge base not updated)",a.data.knowledge_base_error&&console.warn("Knowledge base update failed:",a.data.knowledge_base_error)),i.success(r),b(),c()}else i.error(a.data.detail||"Failed to upload file")}}catch(t){console.error("Error saving entry:",t),i.error(t.response?.data?.detail||"An error occurred while saving")}finally{_(!1)}},M=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return I?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx(ae,{})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-4 sm:px-6 lg:px-8 py-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Knowledge Base"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Manage your knowledge base entries and files"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:$,className:"inline-flex items-center justify-center px-4 py-2 bg-gradient-to-r from-[#1952A8] to-primary-dark text-white text-sm font-medium rounded-lg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Create Entry"]}),e.jsxs("button",{onClick:R,className:"inline-flex items-center justify-center px-4 py-2 bg-gradient-to-r from-[#1952A8] to-primary-dark text-white text-sm font-medium rounded-lg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Upload File"]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[D&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-red-700",children:D}),e.jsx("button",{onClick:c,className:"mt-2 text-sm text-red-700 hover:text-red-900 underline",children:"Try Again"})]})]})}),O&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-lg bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:d?"Edit Entry":g==="manual"?"Create Manual Entry":"Upload File"}),e.jsx("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ne,{className:"w-5 h-5"})})]}),g==="manual"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name *"}),e.jsx("input",{type:"text",value:l.name,onChange:t=>o(a=>({...a,name:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter entry name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("input",{type:"text",value:l.description,onChange:t=>o(a=>({...a,description:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter description (optional)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Content *"}),e.jsxs("div",{className:"mb-3 flex flex-wrap gap-1 p-2 bg-gray-50 rounded-lg border",children:[e.jsx("button",{className:`p-2 rounded transition-all duration-200 ease-in-out ${s?.isActive("heading",{level:1})?"bg-blue-100 text-blue-700 shadow-sm":"text-gray-600 hover:bg-blue-100 hover:text-blue-700"}`,onClick:()=>s?.chain().focus().toggleHeading({level:1}).run(),title:"Heading 1",children:e.jsx(B,{})}),e.jsx("button",{className:`p-2 rounded transition-all duration-200 ease-in-out ${s?.isActive("heading",{level:2})?"bg-blue-100 text-blue-700 shadow-sm":"text-gray-600 hover:bg-blue-100 hover:text-blue-700"}`,onClick:()=>s?.chain().focus().toggleHeading({level:2}).run(),title:"Heading 2",children:e.jsx(B,{style:{fontSize:"0.8em"}})}),e.jsx("button",{className:`p-2 rounded transition-all duration-200 ease-in-out ${s?.isActive("bold")?"bg-blue-100 text-blue-700 shadow-sm":"text-gray-600 hover:bg-blue-100 hover:text-blue-700"}`,onClick:()=>s?.chain().focus().toggleBold().run(),title:"Bold",children:e.jsx(le,{})}),e.jsx("button",{className:`p-2 rounded transition-all duration-200 ease-in-out ${s?.isActive("italic")?"bg-blue-100 text-blue-700 shadow-sm":"text-gray-600 hover:bg-blue-100 hover:text-blue-700"}`,onClick:()=>s?.chain().focus().toggleItalic().run(),title:"Italic",children:e.jsx(re,{})}),e.jsx("button",{className:`p-2 rounded transition-all duration-200 ease-in-out ${s?.isActive("underline")?"bg-blue-100 text-blue-700 shadow-sm":"text-gray-600 hover:bg-blue-100 hover:text-blue-700"}`,onClick:()=>s?.chain().focus().toggleUnderline().run(),title:"Underline",children:e.jsx(ie,{})}),e.jsx("button",{className:`p-2 rounded transition-all duration-200 ease-in-out ${s?.isActive("strike")?"bg-blue-100 text-blue-700 shadow-sm":"text-gray-600 hover:bg-blue-100 hover:text-blue-700"}`,onClick:()=>s?.chain().focus().toggleStrike().run(),title:"Strikethrough",children:e.jsx(oe,{})}),e.jsx("button",{className:`p-2 rounded transition-all duration-200 ease-in-out ${s?.isActive("bulletList")?"bg-blue-100 text-blue-700 shadow-sm":"text-gray-600 hover:bg-blue-100 hover:text-blue-700"}`,onClick:()=>s?.chain().focus().toggleBulletList().run(),title:"Bullet List",children:e.jsx(de,{})}),e.jsx("button",{className:`p-2 rounded transition-all duration-200 ease-in-out ${s?.isActive("orderedList")?"bg-blue-100 text-blue-700 shadow-sm":"text-gray-600 hover:bg-blue-100 hover:text-blue-700"}`,onClick:()=>s?.chain().focus().toggleOrderedList().run(),title:"Numbered List",children:e.jsx(ce,{})})]}),e.jsx("div",{className:"border border-gray-300 rounded-lg bg-white",style:{minHeight:"300px",padding:"16px",fontFamily:"sans-serif",fontSize:"16px",lineHeight:"1.5"},children:e.jsx(ue,{editor:s})})]})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"File *"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all duration-200 ease-in-out",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(T,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"flex text-sm text-gray-600",children:[e.jsxs("label",{className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500 transition-colors",children:[e.jsx("span",{children:"Upload a file"}),e.jsx("input",{ref:k,type:"file",className:"sr-only",onChange:Q,accept:".pdf,.doc,.docx,.txt,.md"})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PDF, DOC, DOCX, TXT, MD up to 10MB"})]})}),f&&e.jsxs("div",{className:"mt-2 flex items-center p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(H,{className:"w-5 h-5 text-blue-500 mr-3"}),e.jsx("span",{className:"text-sm text-blue-700",children:f.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("input",{type:"text",value:l.description,onChange:t=>o(a=>({...a,description:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter description (optional)"})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:V,disabled:S,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-[#1952A8] to-primary-dark border border-transparent rounded-lg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:S?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loader",style:{width:"16px",height:"16px"}}),e.jsx("span",{className:"ml-2",children:d?"Updating...":"Saving..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),d?"Update Entry":"Save Entry"]})})]})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-lg bg-white",children:[e.jsx("div",{className:"flex items-center mb-4",children:e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:e.jsx(F,{className:"h-6 w-6 text-red-600"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Delete Entry"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-6",children:["Are you sure you want to delete ",e.jsxs("span",{className:"font-medium text-gray-900",children:['"',v?.name,'"']}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:J,disabled:N,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:G,disabled:N,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:N?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loader",style:{width:"16px",height:"16px"}}),e.jsx("span",{className:"ml-2",children:"Deleting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Delete"]})})]})]})]})}),e.jsxs("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Knowledge Base Entries"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:[u.length," ",u.length===1?"entry":"entries"," found"]})]}),u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(K,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No entries"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating your first knowledge base entry."}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{onClick:$,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-lg bg-gradient-to-r from-[#1952A8] to-primary-dark text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Create Entry"]})})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:u.map(t=>e.jsx("div",{className:"p-6 hover:bg-blue-50 transition-all duration-200 ease-in-out border-l-4 border-transparent hover:border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.file_type==="upload"?e.jsx(H,{className:"w-5 h-5 text-blue-500 flex-shrink-0"}):e.jsx(K,{className:"w-5 h-5 text-blue-500 flex-shrink-0"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 truncate",children:t.name}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.file_type==="upload","bg-blue-100 text-blue-800"}`,children:t.file_type})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:t.description}),t.content&&t.file_type==="manual"&&e.jsx("div",{className:"text-sm text-gray-700 mb-3 line-clamp-2",dangerouslySetInnerHTML:{__html:t.content}}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsxs("span",{children:["Created: ",M(t.created_at)]}),e.jsx("span",{className:"mx-2",children:"â€¢"}),e.jsxs("span",{children:["Updated: ",M(t.updated_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[t.file_type==="manual"&&e.jsx("button",{onClick:()=>q(t),className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 ease-in-out",title:"Edit",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>X(t),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200 ease-in-out",title:"Delete",children:e.jsx(F,{className:"w-4 h-4"})})]})]})},t.id))})]})]})]})};export{he as default};
